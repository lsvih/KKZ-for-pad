<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/content.css" />
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.css">
		<!--App自定义的css-->
		<link rel="stylesheet" href="../css/index_content.css" />
		<link rel="stylesheet" href="../css/LCalendar.css" />
	</head>

	<body>
		<div id="back-drop"></div>
		<article id="event">
			<!--待量房-->
			<template v-if="event.status==1">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit"><i class="mui-icon mui-icon-compose" v-on:tap="__fEditUser(event.id)"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="block">
					<span>待量房</span><br/><span class="check-time">预约上门时间：<input id="demo1" type="text" readonly="" name="input_date" placeholder="请输入日期" data-lcalendar="2000-01-01,2018-01-29" />
<span class="user-info-edit edit-time"><i class="mui-icon mui-icon-compose"></i>修改日期</span>
				</div>
				<div class="btns block"><span class="event-btn intro" v-on:tap="__fIntro(event.id)"><i class="mui-icon mui-icon-compose"></i>产品介绍</span><span class="event-btn gauge" v-on:tap="__fGauge(event.id)"><i class="mui-icon mui-icon-compose"></i>直接量房</span></div>

			</template>
			<!--待排期-->
			<template v-if="event.status==2">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit" v-on:tap="__fEditUser(event.id)"><i class="mui-icon mui-icon-compose"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="block">
					<span>量房报价信息</span><br/>
					<span v-for="item in event.content.package"><span class="package-item">{{item.name}}：{{item.num}}{{item.unit}}</span></span><br />
					<span>总价:{{event.content.price}}元</span>
					<span class="more-info" v-on:tap="__fDetail(event.id,'gauge')">详情 ></span>
				</div>
				<div class="btns block"><span class="event-btn intro" v-on:tap="__fIntro(event.id)"><i class="mui-icon mui-icon-compose"></i>去排期</span></div>
			</template>

			<!--待选材-->
			<template v-if="event.status==3">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit" v-on:tap="__fEditUser(event.id)"><i class="mui-icon mui-icon-compose"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="block">
					<span>报价信息</span><br/>
					<span v-for="item in event.content.package"><span class="package-item">{{item.name}}：{{item.num}}{{item.unit}}</span></span><br />
					<span>总价:{{event.content.price}}元</span>
					<span class="more-info" v-on:tap="__fDetail(event.id,'gauge')">详情 ></span>
				</div>
				<div class="block">
					<span>排期信息</span><br/>
					<span>{{event.content.schedule}}</span>
					<span class="more-info" v-on:tap="__fDetail(event.id,'schedule')">详情 ></span>
				</div>
				<div class="btns block"><span class="event-btn intro" v-on:tap="__fIntro(event.id)"><i class="mui-icon mui-icon-compose"></i>去选材</span></div>
			</template>

			<!--待签约-->
			<template v-if="event.status==4">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit" v-on:tap="__fEditUser(event.id)"><i class="mui-icon mui-icon-compose"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="rendering block">
					<span class="iteminner">
						<span class="img-contain">
					<span class="lineimg" >
						<span class="item" v-for="img_src in event.content.renderings" track-by="$index"><img class="rendering-images" v-bind:src="img_src"   v-on:tap="previewimages($event,$index)" data-preview-src="" data-preview-group="1" /></span>
					</span>
					</span>
					</span>
				</div>
				<div class="block">
					<span>报价信息</span><br/>
					<span v-for="item in event.content.package"><span class="package-item">{{item.name}}：{{item.num}}{{item.unit}}</span></span><br />
					<span>总价:{{event.content.price}}元</span>
					<span class="more-info" v-on:tap="__fDetail(event.id,'gauge')">详情 ></span>
				</div>
				<div class="block">
					<span>选材信息</span><br/>
					<span>{{event.content.selection}}</span>
					<span class="more-info" v-on:tap="__fDetail(event.id,'selection')">详情 ></span>
				</div>
				<div class="block">
					<span>排期信息</span><br/>
					<span>{{event.content.schedule}}</span>
					<span class="more-info" v-on:tap="__fDetail(event.id,'schedule')">详情 ></span>
				</div>
			</template>

			<!--待支付-->
			<template v-if="event.status==5">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit"><i class="mui-icon mui-icon-compose" v-on:tap="__fEditUser(event.id)"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="block">
					<span>已交定金</span><br/><span class="check-time">预约开工日期：{{event.content.expected_start_date}}</span>
					<br /><span class="check-time">据全款截止日期还剩：<span style="color:red">{{event.content.left_time_for_pay}}天</span></span>
				</div>

			</template>

			<!--待支付（锁定）-->
			<template v-if="event.status==6">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit"><i class="mui-icon mui-icon-compose" v-on:tap="__fEditUser(event.id)"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="block">
					<span>已交定金</span><br/><span class="check-time">预约开工日期：{{event.content.expected_start_date}}</span>
					<br /><span>已截止</span>
				</div>
				<div class="locked block">已锁</div>
			</template>
			<!--待确认开工-->
			<template v-if="event.status==8">
				<div class="user-info block">
					<span class="user-name">{{event.name}}</span><span class="user-sex">{{event.sex?"女士":"先生"}}</span><span class="user-phone">{{event.phone}}</span><span class="user-info-edit"><i class="mui-icon mui-icon-compose" v-on:tap="__fEditUser(event.id)"></i>编辑</span><br /><span class="user-address">{{event.province}}{{event.city}}{{event.district}}{{event.address}}</span><br /><span>合同号：{{event.contractid}}</span>
				</div>
				<div class="block">
					123456
				</div>
				<div class="locked block">已锁</div>
			</template>
			<!--待评价-->
			<template v-if="event.status==20">
				<button class="mui-btn mui-btn-block mui-btn-green remind-user-evaluate">提醒用户评价</button>
			</template>
		</article>

	</body>
	<script src="../js/common.js"></script>
	<script src="../js/data.js"></script>

	<script src="../js/vue.js"></script>

	<script src="../js/mui.js"></script>
	<script type="text/javascript" src="../js/LCalendar.js"></script>
	<script>
		"use strick";
		

		mui.init({
			swipeBack: false,
			statusBarBackground: '#f7f7f7',
			gestureConfig: {
				doubletap: false,
				longtap: false
			}
		});

		function plusReady() {}
		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		var index_content = null;
		var thisevent = fListAllFlowEvent(1)[0]; //从LocalStorage里获取信息
		var MAXIMAGECOUNT = 10;
		mui.plusReady(function() {
			window.addEventListener('refresh', function(event) {
				var aShow = event.detail.split(",");
				vueContent.refresh(aShow[0], aShow[1]);
			});
			
		});
		Vue.filter('statusNumtoString', function(value) {
			return fFindObjById(value, gStatus.status).name;
		})
		var vueContent = new Vue({
			el: '#event',
			data: {
				"event": thisevent
			},
			methods: {
				refresh: function(a, b) {
					document.getElementById("back-drop").style.display = "none";
					this.event = fListAllFlowEvent(a)[b];
					localStorage.thisstatus = this.event.status;
					if(this.event.status == 7) {
						mui.fire(plus.webview.getWebviewById("plg_input"), "refresh", a + "," + b);
						plus.webview.show("plg_input");
					} else {
						fCloseSubPage();
					}
				},
				//打开产品介绍
				__fIntro: function(eventid) {
					mui.openWindow({
						url: "../intro.html",
						id: "intro",
						styles: {
							top: 0,
							bottom: 0,
						},
						extras: {
							eventid: eventid
						},
						show: {
							aniShow: "none"
						},
						waiting: {
							autoShow: false,
						}
					})
				},
				//打开量房页面
				__fGauge: function(eventid) {

				},
				//详情页面
				__fDetail: function(eventid, type) {
					mui.openWindow({
						url: "index_frame.html",
						id: "sub_detail",
						styles: {
							top: '60px',
							bottom: 0,
							left: "38.4%",
							height: "100%",
							width: '61.6%',
							bounce: 'none',
							bounceBackground: '#ffffff'
						},
						extras: {
							type: type,
							eventid: eventid
						},
						show: {
							aniShow: "slide-in-right"
						},
						waiting: {
							autoShow: false,
						}
					});
				},
				//编辑用户信息
				__fEditUser: function(eventid) {
					thispage = plus.webview.currentWebview();
					document.getElementById("back-drop").style.display = "block";
					mui.openWindow({
						url: "edituser.html",
						id: "sub_edituser",
						styles: {
							top: "13%",
							bottom: 0,
							right: "6.8%",
							width: "48%",
							height: "244px"
						},
						extras: {
							eventid: eventid
						},
						show: {
							aniShow: "fade-in"
						},
						waiting: {
							autoShow: false,
						}
					});
				},
				//点击图片放大预览
				previewimages: function(thisevent, indexId) {
					var arrObjects = thisevent.target.parentNode.parentNode.innerHTML;
					mui.openWindow({
						url: "../module/preview_image.html",
						id: "preview_image",
						styles: {
							top: 0,
							bottom: 0,
							right: 0,
							width: "100%",
							height: "100%"
						},
						extras: {
							images: arrObjects,
							indexid: indexId
						},
						show: {
							aniShow: "fade-in"
						},
						waiting: {
							autoShow: false,
						}
					});
				}
			},
			ready: function() {
				var calendar = new LCalendar();
calendar.init({
    'trigger': '#demo1',//标签id
    'type': 'datetime',//date 调出日期选择 datetime 调出日期时间选择 time 调出时间选择 ym 调出年月选择
    'minDate':'1900-1-1',//最小日期 注意：该值会覆盖标签内定义的日期范围
    'maxDate':'2016-3-18'//最大日期 注意：该值会覆盖标签内定义的日期范围
});
			}
		});
		document.getElementById("back-drop").addEventListener("tap", function() {
			document.getElementById("back-drop").style.display = "none";
			plus.webview.close("sub_edituser");
		})

		mui("#event").on("tap", ".edit-time", function() {
			

		});

		function fSelecetTimeChange(e) {
			var inittime = e.getAttribute("init-time");
			if(!e.value)(e.value = inittime, e.blur()); //点击"清除"重新设定时间并关闭时间设定
		}

		function fSaveTime(e) {
			if(e.value == "") e.value = e.getAttribute("init-time"); //防止出现时间为空的情况
			if(e.getAttribute("init-time") != e.value) { //当时间有修改时才进行本地修改与上传操作
				var tempobj = JSON.parse(localStorage.data);
				tempobj.event[fFindObjSortById(thisevent.id, tempobj.event)].content.ordertime = e.value;
				localStorage.data = JSON.stringify(tempobj); //在本地存储修改时间
				var FIFO = JSON.parse(localStorage.FIFO);
				FIFO.push({
					"type": "PUT",
					"object": "edit-order-time",
					"data": e.value
				}); //将修改时间存入队列等待同步
			}
		}
	</script>

</html>